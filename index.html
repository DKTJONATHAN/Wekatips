<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weka Tips - Free Football Betting Tips</title>
    <!-- CSS Links -->
    <link rel="stylesheet" href="styles.css">
    <!-- Cache Control -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Favicon (optional) -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Font Awesome (optional) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts (optional) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Inline critical CSS (optional) */
        .loading-spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">⚽</div>
                    <div class="logo-text">
                        <h1>Weka Tips</h1>
                        <p>Free Football Betting Tips</p>
                    </div>
                </div>
                <div class="success-rate">
                    <div class="rate" id="successRate">--%</div>
                    <p>Success Rate</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <div class="nav-content">
                <div class="nav-links">
                    <a href="#home">Home</a>
                    <a href="#tips">Today's Tips</a>
                    <a href="#about">About</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Stats Bar -->
    <section class="stats-bar">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="number" id="totalTips">--</div>
                    <div class="label">Total Tips</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="winRate">--%</div>
                    <div class="label">Win Rate</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="activeTips">--</div>
                    <div class="label">Today's Tips</div>
                </div>
                <div class="stat-item">
                    <div class="number" id="followers">--</div>
                    <div class="label">Followers</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Today's Premium Tips</h2>
                    <p class="current-date" id="currentDate">Loading...</p>
                    <p class="last-updated">Last updated: <span id="lastUpdatedTime">--:--</span> 
                        <button onclick="loadMatches(true)" class="refresh-btn">Refresh Now</button>
                    </p>
                </div>
            </div>

            <div class="matches-grid" id="matchesContainer">
                <div class="no-matches">Loading matches...</div>
            </div>

            <!-- Disclaimer -->
            <div class="disclaimer">
                <div class="disclaimer-content">
                    <div class="disclaimer-icon">⚠️</div>
                    <div class="disclaimer-text">
                        <h3>Important Disclaimer</h3>
                        <p>Betting involves risk and should be done responsibly. These tips are for entertainment purposes only. Please gamble responsibly and never bet more than you can afford to lose. You must be 18+ to participate in betting activities.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <h3>Weka Tips</h3>
            <p>&copy; <span id="currentYear"></span> Weka Tips. All rights reserved. | Bet Responsibly | 18+</p>
        </div>
    </footer>

    <script>
        // Configuration - Update these values
        const REPO = 'your-username/your-repo-name'; // Format: username/repo
        const FILE_PATH = 'data/tips.json'; // Path to your JSON file
        const BRANCH = 'main'; // Your branch name

        // Global variables
        let matchData = [];
        let lastFetchTime = null;

        // Load matches on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            loadMatches();

            // Refresh every 5 minutes
            setInterval(() => loadMatches(), 300000);
        });

        // Main loading function
        async function loadMatches(forceRefresh = false) {
            const container = document.getElementById('matchesContainer');
            container.innerHTML = '<div class="no-matches">Loading matches...</div>';

            try {
                // 1. Try loading from server first when forcing refresh
                if (forceRefresh) {
                    await fetchMatches();
                    return;
                }

                // 2. Check if we have recent cached data (less than 5 minutes old)
                const cachedData = JSON.parse(localStorage.getItem('cachedMatchData'));
                const cacheTime = localStorage.getItem('cacheTimestamp');

                if (cachedData && cacheTime && (Date.now() - cacheTime < 300000)) {
                    matchData = cachedData;
                    renderMatches();
                    updateLastUpdatedDisplay(cacheTime);
                    return;
                }

                // 3. Fetch fresh data from server
                await fetchMatches();

            } catch (error) {
                console.error("Loading error:", error);
                container.innerHTML = `
                    <div class="no-matches">
                        Failed to load matches. <button onclick="loadMatches(true)">Retry</button>
                    </div>
                `;
            }
        }

        // Fetch matches from GitHub
        async function fetchMatches() {
            const response = await fetch(`https://raw.githubusercontent.com/${REPO}/${BRANCH}/${FILE_PATH}?t=${Date.now()}`);

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();

            if (data.matches && data.matches.length > 0) {
                // Update cache
                matchData = data.matches;
                lastFetchTime = data.updatedAt || new Date().toISOString();

                localStorage.setItem('cachedMatchData', JSON.stringify(matchData));
                localStorage.setItem('cacheTimestamp', Date.now());

                renderMatches();
                updateLastUpdatedDisplay(lastFetchTime);
            } else {
                showNoMatches();
            }
        }

        // Render matches to the page
        function renderMatches() {
            const container = document.getElementById('matchesContainer');

            if (!matchData || matchData.length === 0) {
                showNoMatches();
                return;
            }

            container.innerHTML = '';

            matchData.forEach((match, index) => {
                const matchCard = createMatchCard(match, index);
                container.appendChild(matchCard);
            });

            // Update stats
            updateStats();
        }

        // Create match card element
        function createMatchCard(match, index) {
            const card = document.createElement('div');
            card.className = 'match-card';

            const confidenceClass = {
                'High': 'confidence-high',
                'Medium': 'confidence-medium',
                'Very High': 'confidence-very-high'
            };

            // Format the tip display
            const formattedTip = formatTipForDisplay(match.tip);

            card.innerHTML = `
                <div class="match-header">
                    <div class="match-info">
                        <div class="match-icon">⚽</div>
                        <div class="match-details">
                            <h3>${match.league}</h3>
                            <p>${match.time}</p>
                        </div>
                    </div>
                    <span class="confidence-badge ${confidenceClass[match.confidence]}">
                        ${match.confidence} Confidence
                    </span>
                </div>
                
                <div class="match-teams">
                    <div class="teams-text">${match.homeTeam} vs ${match.awayTeam}</div>
                    <div class="tip-container">
                        ${formattedTip}
                    </div>
                </div>
                
                <div class="match-stats">
                    <div class="stats-row">
                        <span class="odds-info">Odds: <span class="odds-value">${match.odds}</span></span>
                        <span class="odds-info">Potential Return: <span class="odds-value">${(parseFloat(match.odds) * 100).toFixed(0)}%</span></span>
                    </div>
                </div>
                
                <div class="match-actions">
                    <button class="btn btn-primary" onclick="placeBet({
                        match: '${match.homeTeam} vs ${match.awayTeam}',
                        tip: '${match.tip}',
                        odds: '${match.odds}',
                        league: '${match.league}',
                        time: '${match.time}'
                    })">
                        Place Bet
                    </button>
                </div>
            `;

            return card;
        }

        // Format different tip types for display
        function formatTipForDisplay(tip) {
            if (tip.includes('Over')) {
                const value = tip.match(/\d\.\d/)[0];
                return `Over ${value} Goals`;
            } else if (tip.includes('Under')) {
                const value = tip.match(/\d\.\d/)[0];
                return `Under ${value} Goals`;
            } else if (tip.includes('BTTS - Yes')) {
                return 'Both Teams To Score';
            } else if (tip.includes('BTTS - No')) {
                return 'BTTS: No';
            } else if (tip.includes('Win (1X2)')) {
                return tip.replace(' (1X2)', ' Win');
            } else if (tip.includes('Draw (1X2)')) {
                return 'Draw';
            }
            return tip;
        }

        // Show "no matches" message
        function showNoMatches() {
            document.getElementById('matchesContainer').innerHTML = 
                '<div class="no-matches">No matches available today. Check back later!</div>';
            document.getElementById('activeTips').textContent = '0';
            document.getElementById('lastUpdatedTime').textContent = '--:--';
        }

        // Update stats display
        function updateStats() {
            document.getElementById('activeTips').textContent = matchData.length;
            document.getElementById('totalTips').textContent = localStorage.getItem('totalTipsCount') || '--';
            document.getElementById('winRate').textContent = localStorage.getItem('winRate') || '--%';
            document.getElementById('followers').textContent = localStorage.getItem('followersCount') || '--';
            document.getElementById('successRate').textContent = localStorage.getItem('winRate') || '--%';
        }

        // Update last updated time display
        function updateLastUpdatedDisplay(timestamp) {
            const timeEl = document.getElementById('lastUpdatedTime');
            if (!timestamp) {
                timeEl.textContent = '--:--';
                return;
            }

            const date = new Date(timestamp);
            timeEl.textContent = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // Update current date
        function updateDate() {
            const now = new Date();
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
            document.getElementById('currentYear').textContent = now.getFullYear();
        }

        // Place bet handler
        function placeBet(data) {
            const message = `Recommended bet:\n\n${data.match}\nLeague: ${data.league}\nTime: ${data.time}\nTip: ${formatTipForDisplay(data.tip)}\nOdds: ${data.odds}\n\nRemember to bet responsibly!`;
            alert(message);
        }
    </script>
</body>
</html>